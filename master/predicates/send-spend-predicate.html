<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Send and spend funds - The Fuel Rust SDK</title>
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../index.html">The Fuel Rust SDK</a></li><li class="chapter-item expanded "><a href="../getting-started/index.html"><strong aria-hidden="true">1.</strong> Getting Started</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../getting-started/setup.html"><strong aria-hidden="true">1.1.</strong> Setup and Run</a></li><li class="chapter-item expanded "><a href="../getting-started/terminology.html"><strong aria-hidden="true">1.2.</strong> Terminology</a></li><li class="chapter-item expanded "><a href="../getting-started/connecting.html"><strong aria-hidden="true">1.3.</strong> Connecting to a Fuel node</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../providers/external-node.html"><strong aria-hidden="true">1.3.1.</strong> Connecting to the Testnet or an external node</a></li><li class="chapter-item expanded "><a href="../providers/short-lived.html"><strong aria-hidden="true">1.3.2.</strong> Running a short-lived Fuel node with the SDK</a></li><li class="chapter-item expanded "><a href="../providers/querying.html"><strong aria-hidden="true">1.3.3.</strong> Querying the blockchain</a></li></ol></li><li class="chapter-item expanded "><a href="../getting-started/managing-wallets.html"><strong aria-hidden="true">1.4.</strong> Managing wallets</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../wallets/private-keys.html"><strong aria-hidden="true">1.4.1.</strong> Creating a wallet from a private key</a></li><li class="chapter-item expanded "><a href="../wallets/mnemonic-wallet.html"><strong aria-hidden="true">1.4.2.</strong> Creating a wallet from mnemonic phrases</a></li><li class="chapter-item expanded "><a href="../wallets/access.html"><strong aria-hidden="true">1.4.3.</strong> Wallet Access</a></li><li class="chapter-item expanded "><a href="../wallets/encrypting-and-storing.html"><strong aria-hidden="true">1.4.4.</strong> Encrypting and storing wallets</a></li><li class="chapter-item expanded "><a href="../wallets/checking-balances-and-coins.html"><strong aria-hidden="true">1.4.5.</strong> Checking balances and coins</a></li><li class="chapter-item expanded "><a href="../wallets/test-wallets.html"><strong aria-hidden="true">1.4.6.</strong> Setting up test wallets</a></li><li class="chapter-item expanded "><a href="../wallets/signing.html"><strong aria-hidden="true">1.4.7.</strong> Signing</a></li><li class="chapter-item expanded "><a href="../wallets/transferring-assets.html"><strong aria-hidden="true">1.4.8.</strong> Transfering assets</a></li></ol></li><li class="chapter-item expanded "><a href="../getting-started/contracts.html"><strong aria-hidden="true">1.5.</strong> Deploying contracts</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../contracts/interacting-with-contracts.html"><strong aria-hidden="true">1.5.1.</strong> Interacting with contracts</a></li><li class="chapter-item expanded "><a href="../contracts/the-fuelvm-binary-file.html"><strong aria-hidden="true">1.5.2.</strong> The FuelVM Binary file</a></li><li class="chapter-item expanded "><a href="../contracts/the-json-abi-file.html"><strong aria-hidden="true">1.5.3.</strong> The JSON ABI file</a></li><li class="chapter-item expanded "><a href="../contracts/the-abigen-macro.html"><strong aria-hidden="true">1.5.4.</strong> The abigen! macro</a></li><li class="chapter-item expanded "><a href="../contracts/the-setup-contract-test-macro.html"><strong aria-hidden="true">1.5.5.</strong> The setup_contract_test! macro</a></li></ol></li><li class="chapter-item expanded "><a href="../getting-started/calling-contracts.html"><strong aria-hidden="true">1.6.</strong> Calling contracts</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../calling-contracts/calls-with-different-wallets.html"><strong aria-hidden="true">1.6.1.</strong> Connecting wallets</a></li><li class="chapter-item expanded "><a href="../calling-contracts/tx-params.html"><strong aria-hidden="true">1.6.2.</strong> Transaction parameters</a></li><li class="chapter-item expanded "><a href="../calling-contracts/call-params.html"><strong aria-hidden="true">1.6.3.</strong> Call parameters</a></li><li class="chapter-item expanded "><a href="../calling-contracts/call-response.html"><strong aria-hidden="true">1.6.4.</strong> Call response</a></li><li class="chapter-item expanded "><a href="../calling-contracts/logs.html"><strong aria-hidden="true">1.6.5.</strong> Logs</a></li><li class="chapter-item expanded "><a href="../calling-contracts/variable-outputs.html"><strong aria-hidden="true">1.6.6.</strong> Variable outputs</a></li><li class="chapter-item expanded "><a href="../calling-contracts/read-only.html"><strong aria-hidden="true">1.6.7.</strong> Read-only calls</a></li><li class="chapter-item expanded "><a href="../calling-contracts/other-contracts.html"><strong aria-hidden="true">1.6.8.</strong> Calling other contracts</a></li><li class="chapter-item expanded "><a href="../calling-contracts/multicalls.html"><strong aria-hidden="true">1.6.9.</strong> Multiple contract calls</a></li><li class="chapter-item expanded "><a href="../calling-contracts/cost-estimation.html"><strong aria-hidden="true">1.6.10.</strong> Estimating cost</a></li></ol></li><li class="chapter-item expanded "><a href="../getting-started/running-scripts.html"><strong aria-hidden="true">1.7.</strong> Running scripts</a></li><li class="chapter-item expanded "><a href="../getting-started/predicates.html"><strong aria-hidden="true">1.8.</strong> Predicates</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../predicates/send-spend-predicate.html" class="active"><strong aria-hidden="true">1.8.1.</strong> Send and spend funds</a></li></ol></li><li class="chapter-item expanded "><a href="../scripts/index.html"><strong aria-hidden="true">1.9.</strong> Scripts</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../scripts/scripts.html"><strong aria-hidden="true">1.9.1.</strong> Running scripts</a></li></ol></li><li class="chapter-item expanded "><a href="../getting-started/types.html"><strong aria-hidden="true">1.10.</strong> Types</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../types/bytes32.html"><strong aria-hidden="true">1.10.1.</strong> Bytes32</a></li><li class="chapter-item expanded "><a href="../types/address.html"><strong aria-hidden="true">1.10.2.</strong> Address</a></li><li class="chapter-item expanded "><a href="../types/contract-id.html"><strong aria-hidden="true">1.10.3.</strong> ContractId</a></li><li class="chapter-item expanded "><a href="../types/asset-id.html"><strong aria-hidden="true">1.10.4.</strong> AssetId</a></li><li class="chapter-item expanded "><a href="../types/conversion.html"><strong aria-hidden="true">1.10.5.</strong> Converting native types</a></li><li class="chapter-item expanded "><a href="../types/bech32.html"><strong aria-hidden="true">1.10.6.</strong> Bech32</a></li><li class="chapter-item expanded "><a href="../types/custom_types.html"><strong aria-hidden="true">1.10.7.</strong> Structs and enums</a></li><li class="chapter-item expanded "><a href="../types/string.html"><strong aria-hidden="true">1.10.8.</strong> String</a></li><li class="chapter-item expanded "><a href="../types/bits256.html"><strong aria-hidden="true">1.10.9.</strong> Bits256</a></li><li class="chapter-item expanded "><a href="../types/B512.html"><strong aria-hidden="true">1.10.10.</strong> B512</a></li><li class="chapter-item expanded "><a href="../types/evm_address.html"><strong aria-hidden="true">1.10.11.</strong> EvmAddress</a></li><li class="chapter-item expanded "><a href="../types/vectors.html"><strong aria-hidden="true">1.10.12.</strong> Vectors</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../getting-started/api.html"><strong aria-hidden="true">2.</strong> API</a></li><li class="chapter-item expanded "><a href="../debugging/debugging.html"><strong aria-hidden="true">3.</strong> Debugging</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../debugging/abigen.html"><strong aria-hidden="true">3.1.</strong> Debugging abigen errors</a></li><li class="chapter-item expanded "><a href="../debugging/contract-calls.html"><strong aria-hidden="true">3.2.</strong> Debugging contract call errors</a></li><li class="chapter-item expanded "><a href="../debugging/network.html"><strong aria-hidden="true">3.3.</strong> Debugging network errors</a></li><li class="chapter-item expanded "><a href="../debugging/function-selector.html"><strong aria-hidden="true">3.4.</strong> The Function selector</a></li></ol></li><li class="chapter-item expanded "><a href="../testing/index.html"><strong aria-hidden="true">4.</strong> Testing</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../testing/chains.html"><strong aria-hidden="true">4.1.</strong> Tweaking the blockchain</a></li></ol></li><li class="chapter-item expanded "><a href="../cookbook/cookbook.html"><strong aria-hidden="true">5.</strong> Cookbook</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../cookbook/custom-chain.html"><strong aria-hidden="true">5.1.</strong> Custom consensus parameters</a></li><li class="chapter-item expanded "><a href="../cookbook/deposit-and-withdraw.html"><strong aria-hidden="true">5.2.</strong> Deposit and Withdraw</a></li><li class="chapter-item expanded "><a href="../cookbook/transfer-all-assets.html"><strong aria-hidden="true">5.3.</strong> Transfer all assets</a></li></ol></li><li class="chapter-item expanded "><a href="../contributing/contributing.html"><strong aria-hidden="true">6.</strong> Contributing</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../contributing/tests-structure.html"><strong aria-hidden="true">6.1.</strong> Integration tests structure</a></li></ol></li><li class="chapter-item expanded "><a href="../cli/index.html"><strong aria-hidden="true">7.</strong> Command Line Interfaces</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../cli/fuels-abi-cli.html"><strong aria-hidden="true">7.1.</strong> fuels-abi-cli</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">The Fuel Rust SDK</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/FuelLabs/fuels-rs" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="send-and-spend-funds-from-predicates"><a class="header" href="#send-and-spend-funds-from-predicates">Send and spend funds from predicates</a></h1>
<p>Let's consider the following predicate example:</p>
<pre><code class="language-rust ignore">predicate;

use std::{b512::B512, constants::ZERO_B256, ecr::ec_recover_address, inputs::input_predicate_data};

fn extract_pulic_key_and_match(signature: B512, expected_public_key: b256) -&gt; u64 {
    if let Result::Ok(pub_key_sig) = ec_recover_address(signature, ZERO_B256)
    {
        if pub_key_sig.value == expected_public_key {
            return 1;
        }
    }
    0
}

fn main() -&gt; bool {
    let signatures: [B512; 3] = input_predicate_data(0);

    let public_keys = [
        0xd58573593432a30a800f97ad32f877425c223a9e427ab557aab5d5bb89156db0,
        0x14df7c7e4e662db31fe2763b1734a3d680e7b743516319a49baaa22b2032a857,
        0x3ff494fb136978c3125844625dad6baf6e87cdb1328c8a51f35bda5afe72425c,
    ];

    let mut matched_keys = 0;

    matched_keys = extract_pulic_key_and_match(signatures[0], public_keys[0]);
    matched_keys = matched_keys + extract_pulic_key_and_match(signatures[1], public_keys[1]);
    matched_keys = matched_keys + extract_pulic_key_and_match(signatures[2], public_keys[2]);

    matched_keys &gt; 1
}
</code></pre>
<p>This predicate accepts three signatures and matches them to three predefined public keys. The <code>ec_recover_address</code> function is used to recover the public key from the signatures. If two of three extracted public keys match the predefined public keys, the funds can be spent. Note that the signature order has to match the order of the predefined public keys.</p>
<p>Let's use the SDK to interact with the predicate. First, let's create three wallets with specific keys. Their hashed public keys are already hard-coded in the predicate.</p>
<pre><code class="language-rust ignore">        let secret_key1: SecretKey =
            &quot;0x862512a2363db2b3a375c0d4bbbd27172180d89f23f2e259bac850ab02619301&quot;
                .parse()
                .unwrap();

        let secret_key2: SecretKey =
            &quot;0x37fa81c84ccd547c30c176b118d5cb892bdb113e8e80141f266519422ef9eefd&quot;
                .parse()
                .unwrap();

        let secret_key3: SecretKey =
            &quot;0x976e5c3fa620092c718d852ca703b6da9e3075b9f2ecb8ed42d9f746bf26aafb&quot;
                .parse()
                .unwrap();

        let mut wallet = WalletUnlocked::new_from_private_key(secret_key1, None);
        let mut wallet2 = WalletUnlocked::new_from_private_key(secret_key2, None);
        let mut wallet3 = WalletUnlocked::new_from_private_key(secret_key3, None);
        let receiver = WalletUnlocked::new_random(None);
</code></pre>
<p>Next, let's add some coins, start a provider and connect it with the wallets.</p>
<pre><code class="language-rust ignore">        let all_coins = [&amp;wallet, &amp;wallet2, &amp;wallet3]
            .iter()
            .flat_map(|wallet| {
                setup_single_asset_coins(wallet.address(), AssetId::default(), 10, 1_000_000)
            })
            .collect::&lt;Vec&lt;_&gt;&gt;();

        let (provider, _) = setup_test_provider(
            all_coins,
            vec![],
            Some(Config {
                utxo_validation: true,
                ..Config::local_node()
            }),
            None,
        )
        .await;

        [&amp;mut wallet, &amp;mut wallet2, &amp;mut wallet3]
            .iter_mut()
            .for_each(|wallet| wallet.set_provider(provider.clone()));
</code></pre>
<p>Now we can load the predicate binary, and prepare some transaction variables.</p>
<pre><code class="language-rust ignore">        let predicate = Predicate::load_from(
            &quot;../../packages/fuels/tests/predicates/predicate_signatures/out/debug/predicate_signatures.bin&quot;,
        )?;

        let predicate_code = predicate.code();
        let predicate_address = predicate.address();
        let amount_to_predicate = 1000;
        let asset_id = AssetId::default();
</code></pre>
<p>After the predicate address is generated we can send funds to it. Note that we are using the same <code>transfer</code> function as we used when sending funds to other wallets. We also make sure that the funds are indeed transferred.</p>
<pre><code class="language-rust ignore">        wallet
            .transfer(
                predicate_address,
                amount_to_predicate,
                asset_id,
                TxParameters::default(),
            )
            .await?;

        let predicate_balance = provider
            .get_asset_balance(predicate.address(), asset_id)
            .await?;
        assert_eq!(predicate_balance, amount_to_predicate);
</code></pre>
<p>To spend the funds that are now locked in the predicate, we have to provide two out of three signatures whose public keys match the ones we defined in the predicate. In this example, the signatures are generated from an array of zeros.</p>
<pre><code class="language-rust ignore">        let data_to_sign = [0; 32];
        let signature1 = wallet.sign_message(data_to_sign).await?.to_vec();
        let signature2 = wallet2.sign_message(data_to_sign).await?.to_vec();
        let signature3 = wallet3.sign_message(data_to_sign).await?.to_vec();

        let signatures = vec![signature1, signature2, signature3];
</code></pre>
<p>After generating the signatures, we can send a transaction to spend the predicate funds. We use the <code>receiver</code> wallet as the recipient. We have to provide the predicate byte code and the required signatures. As we provide the correct data, we receive the funds and verify that the amount is correct.</p>
<pre><code class="language-rust ignore">        let predicate_data = signatures.into_iter().flatten().collect();
        wallet
            .spend_predicate(
                predicate_address,
                predicate_code,
                amount_to_predicate,
                asset_id,
                receiver.address(),
                Some(predicate_data),
                TxParameters::default(),
            )
            .await?;

        let receiver_balance_after = provider
            .get_asset_balance(receiver.address(), asset_id)
            .await?;
        assert_eq!(amount_to_predicate, receiver_balance_after);

        let predicate_balance = provider
            .get_asset_balance(predicate.address(), asset_id)
            .await?;
        assert_eq!(predicate_balance, 0);
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../getting-started/predicates.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="../scripts/index.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../getting-started/predicates.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="../scripts/index.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
    </body>
</html>
